                                                         SCRIPTS DE CRIAÇAO NO POSTGRESQL
                                                         
                                                         
                                                         
                                                         
                                                         
                                                         
                                                         
                                                         
                                                         
                                                         --Criação do usuario; 

CREATE ROLE "Joao Lucas" WITH
  LOGIN
  SUPERUSER
  INHERIT
  CREATEDB
  CREATEROLE
  REPLICATION
  ENCRYPTED PASSWORD 'SCRAM-SHA-256$4096:hzpOnROLC3kZ+ZwPY3gibA==$wo8tkAWQu8dwJ1I3S3zCFjny/rMHo/fiPuMCGK6mxx0=:RYwfNIq6IR6XhcoeB39LxSOx2yxTvu6By2RFfgDetZ0=';
  
  
                                                         --Setando como usuario adm do BD e das tabelas do esquema elmasri;
  
  
  alter user "Joao Lucas"
  set search_path to elmsari, "&Joao Lucas", public;


  
                                                          --Criação da database UVV;

CREATE DATABASE "UVV"
    WITH 
    OWNER = "Joao Lucas"
    ENCODING = 'UTF8'
    LC_COLLATE = 'en_US.UTF-8'
    LC_CTYPE = 'en_US.UTF-8'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;
    
    
    
    --Criação do Schema elmasri;
  
  CREATE SCHEMA IF NOT EXISTS elmasri
    AUTHORIZATION "Joao Lucas";
    
    
    
                                                         --Criação da tabela Departamento;                                                         
                                                         --Primary Key (numero_departamento);
                                                         --Foreign Key (nome_departamento);
                                                         --Unique Key (cpf_gerente);
    
   CREATE TABLE IF NOT EXISTS elmasri.departamento
(
    numero_departamento integer NOT NULL,
    nome_departamento character varying(15) COLLATE pg_catalog."default" NOT NULL,
    cpf_gerente character(11) COLLATE pg_catalog."default" NOT NULL,
    data_inicio_gerente date,
    CONSTRAINT departamento_pkey PRIMARY KEY (numero_departamento),
    CONSTRAINT departamento_funcionario_fk FOREIGN KEY (cpf_gerente)
        REFERENCES elmasri.funcionario (cpf) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS elmasri.departamento
    OWNER to "Joao Lucas";
    --Criaçao da UNIQUE KEY; 
    CREATE UNIQUE INDEX IF NOT EXISTS departamento_idx
    ON elmasri.departamento USING btree
    (nome_departamento COLLATE pg_catalog."default" ASC NULLS LAST)
    TABLESPACE pg_default;
    
                                                          
                                                          
                                                          
                                                          
                                                      --Criação da tabela dependente;                                                          
                                                      --PRIMARY KEY (cpf_funcionario);
                                                      --UNIQUE KEY (cpf_funcionario, nome_dependente);
                                                                                                                         
CREATE TABLE IF NOT EXISTS elmasri.dependente
(
    cpf_funcionario character(11) COLLATE pg_catalog."default" NOT NULL,
    nome_dependente character varying(15) COLLATE pg_catalog."default" NOT NULL,
    sexo character(1) COLLATE pg_catalog."default",
    data_nascimento date,
    parentesco character varying(15) COLLATE pg_catalog."default",
    CONSTRAINT dependente_pkey PRIMARY KEY (cpf_funcionario, nome_dependente),
    CONSTRAINT dependente_sexo_check CHECK (sexo = 'F'::bpchar OR sexo = 'M'::bpchar)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS elmasri.dependente
    OWNER to "Joao Lucas";
    
    
    
                                                     
                                                     
                                                     
                                                     
                                                     --Criação da tabela Localizaçoes_departamento;
                                                     --Primary Key (numero_departamento, local);
                                                     --Foreign Key (numero_departamento);
                                                                                                      
    CREATE TABLE IF NOT EXISTS elmasri.localizacoes_departamento
(
    numero_departamento integer NOT NULL,
    local character varying(15) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT localizacoes_departamento_pkey PRIMARY KEY (numero_departamento, local)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS elmasri.localizacoes_departamento
    OWNER to "Joao Lucas";
    
    
    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    --Criação da tabela Funcionario;                                                
                                                    --Primary Key (cpf);
                                                    --Foreign Key (cpf_supervisor);
                                                                                                       
    CREATE TABLE IF NOT EXISTS elmasri.funcionario
(
    cpf character(11) COLLATE pg_catalog."default" NOT NULL,
    primeiro_nome character varying(15) COLLATE pg_catalog."default" NOT NULL,
    nome_meio character(1) COLLATE pg_catalog."default",
    ultimo_nome character varying(15) COLLATE pg_catalog."default" NOT NULL,
    data_nascimento date,
    endereco character varying(50) COLLATE pg_catalog."default",
    sexo character(1) COLLATE pg_catalog."default",
    salario numeric(10,2),
    cpf_supervisor character(11) COLLATE pg_catalog."default",
    numero_departamento integer NOT NULL DEFAULT 1,
    CONSTRAINT funcionario_pkey PRIMARY KEY (cpf),
    CONSTRAINT funcionario_sexo_check CHECK (sexo = 'F'::bpchar OR sexo = 'M'::bpchar),
    CONSTRAINT funcionario_salario_check CHECK (salario > 0::numeric)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS elmasri.funcionario
    OWNER to "Joao Lucas";
         
    
                                                     
                                                     
                                                     
                                                     
                                                     
                                                     --Criação da tabela Projeto;                                                     
                                                     --Primary Key (numero_projeto);
                                                     --Foreign Key (numero_departamento);
                                                     --Unique Key (nome_projeto);
 CREATE TABLE IF NOT EXISTS elmasri.projeto
(
    numero_projeto integer NOT NULL,
    nome_projeto character varying(15) COLLATE pg_catalog."default" NOT NULL,
    local_projeto character varying(15) COLLATE pg_catalog."default",
    numero_departamento integer NOT NULL,
    CONSTRAINT projeto_pkey PRIMARY KEY (numero_projeto),
    CONSTRAINT departamento_projeto_fk FOREIGN KEY (numero_departamento)
        REFERENCES elmasri.departamento (numero_departamento) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS elmasri.projeto
    OWNER to "Joao Lucas";
    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    --Criação da tabela trabalha_em;
                                                    
                                                    --Primary Key (cpf_funcionario, numero_projeto);
                                                    --Foreign Key (cpf_funcionario, numero_projeto);
 
 
 
 CREATE TABLE IF NOT EXISTS elmasri.trabalha_em
(
    cpf_funcionario character(11) COLLATE pg_catalog."default" NOT NULL,
    numero_projeto integer NOT NULL,
    horas numeric(3,1),
    CONSTRAINT trabalha_em_pkey PRIMARY KEY (cpf_funcionario, numero_projeto),
    CONSTRAINT projeto_trabalha_em_fk FOREIGN KEY (numero_projeto)
        REFERENCES elmasri.projeto (numero_projeto) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION,
    CONSTRAINT trabalha_em_horas_check CHECK (horas > 0::numeric)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS elmasri.trabalha_em
    OWNER to "Joao Lucas";
                                                             

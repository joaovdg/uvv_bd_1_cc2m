/*
QUESTÃO 1
*/ 

select d.nome_departamento as departamento
,   avg(f.salario)         as salario_medio
from funcionario f
inner join departamento d on (f.numero_departamento = d.numero_departamento)
group by d.nome_departamento
;


/*
QUESTÃO 02
*/

select sexo          as sexo
,    avg(salario)    as sario_medio
from funcionario
group by sexo
;


/*
QUESTÃO 03
*/


select d.nome_departamento
, CONCAT(f.primeiro_nome,' ', f.nome_meio,' ', f.ultimo_nome) as funcionario
, TO_CHAR(f.data_nascimento, 'DD/MM/YYYY')
, EXTRACT(YEAR FROM AGE(TIMESTAMP f.data_nascimento)) as idade
, f.salario as salario  
from departamento d
inner join funcionario f on (f.numero_departamento = d.numero_departamento)
order by f.salario desc
;

/*
QUESTÃO 04
*/
select (f.primeiro_nome,' ', f.nome_meio,' ', f.ultimo_nome) as funcionario
, EXTRACT(YEAR FROM AGE(TIMESTAMP f.data_nascimento)) as idade
, f.salario as salario.atual 
, case
when f.salario < 35000 then f.salario * 1.2
when f.salario >= 35000 then f.salario * 1.15
else '?'
end as salario_reajustado  

FROM elmasri.funcionario AS f;
/*
QUESTÃO 05
*/
select d.nome_departamento as departamento
       , g.primeiro nome as gerente
       , f.primeiro nome as funcionario
from departamento d
inner join funcionario g on (d.cpf_gerente = g.cpf)
inner join funcionario f on (d.numero_departamento = f.numero_departamento)
order by d.nome_departamento ASC
       , f.salario desc
;


/*
QUESTÃO 06
*/

SELECT
CONCAT(f.primeiro_nome, ' ',f.nome_meio, '.', ' ', f.ultimo_nome) AS "Nome do Funcionário",
dp.nome_dependente AS "Nome do Dependente",
EXTRACT(year FROM age(dp.data_nascimento)) AS "Idade",

CASE
    WHEN dp.sexo = 'M' THEN 'Masculino'
    WHEN dp.sexo = 'F' THEN 'Feminino'
    END AS "Sexo do dependente"

FROM elmasri.dependente AS dp
INNER JOIN elmasri.funcionario AS f ON f.cpf = dp.cpf_funcionario;

/*
QUESTÃO 07
*/

SELECT 
CONCAT(f.primeiro_nome, ' ',f.nome_meio, '.', ' ', f.ultimo_nome) AS "Nome Completo",
d.nome_departamento AS "Departamento",
CONCAT('R$ ',ROUND((f.salario),2)) AS "Salário"

FROM elmasri.funcionario AS f
INNER JOIN elmasri.departamento AS d ON d.numero_departamento = f.numero_departamento
WHERE f.cpf NOT IN (
    
    SELECT 
    dp.cpf_funcionario
    FROM elmasri.dependente AS dp


);

/*
QUESTÃO 08
*/

SELECT
CONCAT(f.primeiro_nome, ' ',f.nome_meio, '.', ' ', f.ultimo_nome) AS "Nome Completo",
d.nome_departamento AS "Departamento",
p.nome_projeto AS "Projeto",
tbm.horas AS "Horas trabalhadas"


FROM elmasri.departamento AS d 
INNER JOIN elmasri.projeto AS p ON p.numero_departamento = d.numero_departamento
INNER JOIN elmasri.trabalha_em AS tbm ON tbm.numero_projeto = p.numero_projeto
INNER JOIN elmasri.funcionario AS f ON f.cpf = tbm.cpf_funcionario;

/*
QUESTÃO 09
*/
SELECT

d.nome_departamento AS "Nome Departamento",
p.nome_projeto AS "Nome do Projeto",
SUM(tbm.horas) AS "Horas Trabalhadas"


FROM elmasri.trabalha_em AS tbm
INNER JOIN elmasri.projeto AS p ON p.numero_projeto = tbm.numero_projeto
INNER JOIN elmasri.departamento AS d ON d.numero_departamento = p.numero_departamento
GROUP BY p.nome_projeto, d.nome_departamento
ORDER BY d.nome_departamento;

/*
QUESTÃO 10
*/

SELECT d.numero_departamento, AVG(salario) AS media_salarial
FROM funcionarios AS f, departamento AS d
WHERE d.numero_departamento = f.numero_departamento
GROUP BY d.numero_departamento ;
/*
QUESTÃO 11
*/


SELECT 
CONCAT(f.primeiro_nome, ' ',f.nome_meio, '.', ' ', f.ultimo_nome) AS "Nome Completo",
p.nome_projeto AS "Nome do Projeto",
CONCAT('R$ ', (tbm.horas * 50)) AS "A receber por horas"

FROM elmasri.funcionario AS f
INNER JOIN elmasri.trabalha_em AS tbm ON tbm.cpf_funcionario = f.cpf
INNER JOIN elmasri.projeto AS p ON p.numero_projeto = tbm.numero_projeto
GROUP BY f.cpf, p.nome_projeto, tbm.horas;

/*
QUESTÃO 12
*/



SELECT 
d.nome_departamento AS "Nome Departamento",
p.nome_projeto AS "Nome do Projeto",
CONCAT(f.primeiro_nome, ' ',f.nome_meio, '.', ' ', f.ultimo_nome) AS "Nome Completo"

FROM elmasri.departamento AS d
INNER JOIN elmasri.projeto AS p ON p.numero_departamento = d.numero_departamento
INNER JOIN elmasri.trabalha_em AS tbm ON tbm.numero_projeto = p.numero_projeto
INNER JOIN elmasri.funcionario AS f ON f.cpf = tbm.cpf_funcionario

WHERE tbm.horas IS NULL;


/*
QUESTÃO 13
*/




SELECT 
CONCAT(f.primeiro_nome, ' ',f.nome_meio, '.', ' ', f.ultimo_nome) AS "Nome Completo",
EXTRACT(year FROM age(f.data_nascimento)) AS "Idade",
CASE
    WHEN f.sexo = 'M' THEN 'Masculino'
    WHEN f.sexo = 'F' THEN 'Feminino'
    END AS "Sexo"

FROM elmasri.funcionario AS f

UNION

SELECT
CONCAT(dp.nome_dependente) AS "Nome Completo",
EXTRACT(year FROM age(dp.data_nascimento)) AS "Idade",
CASE
    WHEN dp.sexo = 'M' THEN 'Masculino'
    WHEN dp.sexo = 'F' THEN 'Feminino'
    END AS "Sexo"

FROM elmasri.dependente AS dp

ORDER BY 2 DESC;

/*
QUESTÃO 14
*/
SELECT
d.nome_departamento AS "Nome Departamento", 
COUNT(f.cpf) AS "Nº de Funcionários"

FROM elmasri.funcionario AS f
INNER JOIN elmasri.departamento AS d ON d.numero_departamento = f.numero_departamento
GROUP BY d.nome_departamento;
/*
QUESTÃO 15



*/
SELECT
CONCAT(f.primeiro_nome, ' ',f.nome_meio, '.', ' ', f.ultimo_nome) AS "Nome Completo",
d.nome_departamento AS "Nome Departamento",
p.nome_projeto AS "Nome Projeto"


FROM elmasri.funcionario AS f 
INNER JOIN elmasri.departamento AS d ON d.numero_departamento = f.numero_departamento
LEFT JOIN elmasri.projeto AS p ON p.numero_departamento = f.numero_departamento
ORDER BY f.primeiro_nome;
